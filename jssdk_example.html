<!DOCTYPE html>
<html>

<head>
  <title>微信JS-SDK获取地理位置</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
  <meta name="full-screen" content="yes">
  <meta name="x5-fullscreen" content="true">
</head>

<body>
  测试
  <div id="nowAddress">

  </div>

</body>
<script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script type="text/javascript" src="/wechat_map/jssdk-config.js"></script>
<script type="text/javascript">
  // 配置成功后执行
  wx.ready(function() {

    // 获取地理位置
    wx.getLocation({
      type: 'wgs84',
      success: function(res) {
        var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
        var speed = res.speed; // 速度，以米/每秒计
        var accuracy = res.accuracy; // 位置精度
        var geocoder = new qq.maps.Geocoder({
          complete: function(result) { //解析成功的回调函数
            var address = result.detail.address.substring(5); //获取详细地址信息 
            $('#nowAddress').text('')
            $('#nowAddress').text(address) //将解析出来的地址渲染到页面
          }
        });
        geocoder.getAddress(new qq.maps.LatLng(latitude, longitude));
        //周边设备位置展示
        $.ajax({
          url: "nearby/getNearby",
          data: {
            latitude: latitude,
            longitude: longitude
          },
          type: "get",
          dataType: "json",
          success: function(data) {
            //使用微信内置地图查看位置接口
				wx.openLocation({
					latitude : res.latitude, // 纬度，浮点数，范围为90 ~ -90
					longitude : res.longitude, // 经度，浮点数，范围为180 ~ -180。
					name : '我的位置', // 位置名
					address : '329创业者社区', // 地址详情说明
					scale : 28, // 地图缩放级别,整形值,范围从1~28。默认为最大
					infoUrl : 'http://www.gongjuji.net' // 在查看位置界面底部显示的超链接,可点击跳转（测试好像不可用）
				});
          }
        })
      },
      cancel: function(res) {
        alert('用户拒绝授权获取地理位置');
      }
    });

  });
</script>

</html>
